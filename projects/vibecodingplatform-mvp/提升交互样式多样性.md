
请在 `projects/vibecodingplatform-mvp` 中实现 **L0 交互/样式门禁（Hard Rules + Checks）**，用于稳定生成可交互应用（尤其 Sudoku/棋盘/网格类），并防止 shadcn/ui Input 覆盖 CSS Modules 的经典样式。

### 一、要落地的 6 条硬规则（写入系统策略/门禁提示文本）

1. **表单输入才用 shadcn Input**
   `@/components/ui/input` 只允许用于表单/设置/搜索/登录等普通输入场景。
2. **结构性控件必须用原生元素**
   棋盘/网格/像素画布/编辑器/拖拽/表格单元格等场景必须优先用原生 `div/button/input`（禁止默认用 shadcn Input）。
3. **精细样式只允许 CSS Modules 且仅在 generated 命名空间**
   只允许 `src/components/generated/**.module.css`；组件必须 `import styles from './X.module.css'`；关键样式类必须施加在“可见元素”（原生 input/button/div）上，而不是仅 wrapper。
4. **禁止全局样式与危险 CSS**
   禁止修改 `src/index.css/globals.css`；CSS Modules 禁止 `:global()`、`@import`、`url(http...)`。
5. **受控输入必须闭环**
   JSX 中出现 `value=` 时，必须同时存在 `onChange=` 并更新 state，或明确 `readOnly`。
6. **业务多文件必须接线**
   新增 `src/components/generated/<appSlug>/**` 文件必须被引用；未引用视为孤儿（默认 warning，可配置为 error）。

### 二、实现位置

* 在 `projects/vibecodingplatform-mvp/backend/quality_gates.py` 新增 `run_l0_gates(files, context)`，并在生成完成后调用。
* 在 `projects/vibecodingplatform-mvp/backend/self_heal.py` 的自愈提示里回灌：

  * `failed_gates`（失败项 + 具体原因）
  * `allowed_paths`（白名单）
  * `recommended_fix`（可执行修复步骤）

### 三、L0 门禁：6 个检查点（先用 regex，后续可升级 AST）

#### Gate 1：结构性应用禁止使用 shadcn Input（Fail）

**判定为结构性应用的触发条件（任意命中即可）：**

* 用户 prompt / InteractionSpec / 项目名 / 文件路径包含关键词（中英文都支持）：
  `sudoku|minesweeper|2048|grid|board|pixel|canvas|calendar|gantt|kanban|spreadsheet|datagrid|timeline|flow|diagram|drag|棋盘|网格|数独|像素|画布|日历|甘特|看板|拖拽|表格`
* 或出现文件名：`Sudoku|Grid|Board|Cell|Canvas|Kanban|Calendar|Gantt|Spreadsheet`

**Fail 条件：**

* 任意 TS/TSX 文件中命中：

  * `from '@/components/ui/input'` / `from "@\/components\/ui\/input"`
  * 或 JSX 出现 `<Input`

**修复提示：**

* 将 `<Input>` 替换为原生 `<input>` 或 `<button>`，并把 CSS Modules 的 class 施加在原生元素上。

#### Gate 2：CSS Modules 必须与组件同名同目录，且必须被 import（Fail）

* 对 `src/components/generated/**/(X).module.css`：

  * 必须存在同目录 `X.tsx` 或 `X.jsx/tsx`（按你们规则优先 tsx）
  * 且组件中必须存在 `import styles from './X.module.css'`
    否则 Fail。

#### Gate 3：禁止危险 CSS（Fail）

扫描 `src/components/generated/**/*.module.css`：

* 命中 `:global(` => Fail
* 命中 `@import` => Fail
* 命中 `url(http` 或 `url(https` => Fail

#### Gate 4：受控输入闭环（Fail）

扫描 TS/TSX 中每个 `<input ...>` 或 `<Input ...>` 标签块（可用“同标签文本块”简化）：

* 若标签内出现 `value=`，则必须出现 `onChange=` 或 `readOnly`
  否则 Fail。

#### Gate 5：防“填了就锁死”的 readOnly 逻辑（Fail/Warning）

若出现 `readOnly={...}`：

* 若条件中出现 `value`/`cell` 等当前值判断（如 `value !== null`），且不包含 `original|locked|given|isOriginal` 等语义变量：

  * 对 Sudoku/结构性应用：Fail
  * 对一般应用：Warning

#### Gate 6：新增文件必须被引用（Warning 默认）

对本次生成新增的 `src/components/generated/<appSlug>/**/*.tsx`：

* 若未在任何 TS/TSX 中被 import 引用（简单全仓 regex 搜索其路径/文件名）：

  * 默认 Warning（输出孤儿文件列表 + 建议在 Index 或 feature root 接线）
  * 可在回归测试/发布模式切换为 Fail（加配置开关）

### 四、输出格式（便于前端展示与自愈）

`run_l0_gates` 返回结构化结果：

```json
{
  "pass": false,
  "fails": [
    {"gate": "G1_STRUCTURAL_NO_SHADCN_INPUT", "files": ["src/components/generated/sudoku/SudokuCell.tsx"], "message": "Structural app must not use shadcn Input; use native <input>/<button>."}
  ],
  "warnings": [
    {"gate": "G6_ORPHAN_FILES", "files": ["src/components/generated/sudoku/Unused.tsx"], "message": "New file is not imported anywhere. Wire it up or delete."}
  ],
  "hints": [
    "For grid/board UIs: use native input/button and apply CSS Modules classes to the visible element itself.",
    "Do not edit src/index.css or src/components/ui/**."
  ]
}
```

### 五、失败时自愈回灌提示（强约束）

当 L0 fail：

* 不进入后续门禁（typecheck/test）直接触发一次 `/improve` 自愈
* 自愈 prompt 必须包含：

  * `failed_gates` 列表
  * `allowed_paths` 白名单（只允许修业务层与 generated）
  * “禁止修改”清单（ui 组件库/全局样式/配置）

并明确要求模型按 gate 提示修复。

### 六、附：Sudoku 专用强制修复策略（用于自愈）

当 Gate1 触发且涉及 Sudoku：

* 明确要求把 `@/components/ui/input` 替换为原生 `<input>`
* `className={styles.cell}` 必须施加在 `<input>` 本体
* 禁止通过 `!important` 或 `:global` 绕过

---

请按以上规则在后端实现 L0 门禁，并确保在日志中打印 gate 结果，方便我调试。

---
