# L0 äº¤äº’/æ ·å¼é—¨ç¦å®æ–½æ€»ç»“

## ğŸ‰ å®æ–½å®Œæˆ

å·²æˆåŠŸå®ç° L0 äº¤äº’/æ ·å¼é—¨ç¦ç³»ç»Ÿï¼Œä¸“é—¨é’ˆå¯¹ç»“æ„æ€§åº”ç”¨ï¼ˆæ•°ç‹¬/æ£‹ç›˜/ç½‘æ ¼ï¼‰çš„æ ·å¼å’Œäº¤äº’é—®é¢˜ï¼Œè§£å†³äº†"ç»å…¸çº¸è´¨æ•°ç‹¬æ ·å¼ä¸ç”Ÿæ•ˆ"çš„æ ¹æœ¬åŸå› ã€‚

## ğŸ“‹ å®æ–½å†…å®¹

### 1. æ–°å¢æ ¸å¿ƒæ¨¡å—

#### `backend/l0_gates.py`
- **Gate1**: ç»“æ„æ€§åº”ç”¨ç¦ç”¨ shadcn Input
  - æ£€æµ‹ï¼š`from '@/components/ui/input'` æˆ– `<Input` æ ‡ç­¾
  - ä¿®å¤å»ºè®®ï¼šä½¿ç”¨åŸç”Ÿ `<input>` æˆ– `<button>`ï¼Œå¹¶å°† CSS Modules class æ–½åŠ åœ¨å¯è§å…ƒç´ æœ¬ä½“

- **Gate2**: CSS Modules åŒååŒç›®å½• + å¿…é¡» import
  - æ£€æµ‹ï¼šCSS Module æ–‡ä»¶å¿…é¡»æœ‰å¯¹åº”çš„åŒåç»„ä»¶ï¼Œä¸”ç»„ä»¶å¿…é¡» import å®ƒ
  - ä¿®å¤å»ºè®®ï¼šåˆ›å»ºå¯¹åº”ç»„ä»¶æˆ–åˆ é™¤å­¤å„¿ CSS Module

- **Gate3**: ç¦æ­¢å±é™© CSS
  - æ£€æµ‹ï¼š`:global()`ã€`@import`ã€`url(http...)`
  - ä¿®å¤å»ºè®®ï¼šç§»é™¤å…¨å±€æ±¡æŸ“å’Œå¤–éƒ¨èµ„æºå¼•ç”¨

- **Gate4**: å—æ§è¾“å…¥é—­ç¯
  - æ£€æµ‹ï¼š`value=` å¿…é¡»é… `onChange=` æˆ– `readOnly`
  - ä¿®å¤å»ºè®®ï¼šæ·»åŠ  onChange handler æˆ–æ˜ç¡® readOnly

- **Gate5**: é˜²"å¡«äº†å°±é”æ­»"çš„ readOnly é€»è¾‘
  - æ£€æµ‹ï¼šreadOnly æ¡ä»¶æ˜¯å¦åŸºäºå½“å‰å€¼è€Œéåˆå§‹å€¼
  - ç»“æ„æ€§åº”ç”¨ï¼šFailï¼ˆè§¦å‘è‡ªæ„ˆï¼‰
  - æ™®é€šåº”ç”¨ï¼šWarning

- **Gate6**: æ–°å¢æ–‡ä»¶å¿…é¡»è¢«å¼•ç”¨
  - æ£€æµ‹ï¼šç”Ÿæˆçš„ç»„ä»¶æ–‡ä»¶æ˜¯å¦è¢«å…¶ä»–æ–‡ä»¶ import
  - ç»“æ„æ€§åº”ç”¨ï¼šErrorï¼ˆè§¦å‘è‡ªæ„ˆï¼‰
  - æ™®é€šåº”ç”¨ï¼šWarning

### 2. ç­–ç•¥é…ç½®

#### `backend/policies/generation_policy.json`
æ·»åŠ äº† `l0_style_gates` é…ç½®èŠ‚ï¼š
```json
{
  "l0_style_gates": {
    "enabled": true,
    "structural_keywords": ["sudoku", "grid", "board", "canvas", ...],
    "structural_filename_keywords": ["Sudoku", "Grid", "Board", "Cell", ...],
    "forbidden_css_patterns": [":global\\s*\\(", "@import", "url\\s*\\(\\s*[\"']?https?:"],
    "gate5_structural_fail": true,
    "gate6_orphan_severity_mode": "error_structural"
  }
}
```

### 3. é›†æˆåˆ°ç”Ÿæˆæµç¨‹

#### `backend/server.py`
- åœ¨ `generate_with_template()` ä¸­ï¼Œ`final_files` åˆå¹¶åã€è´¨é‡é—¨ç¦å‰è¿è¡Œ L0 é—¨ç¦
- æ„å»ºä¸Šä¸‹æ–‡ï¼š`prompt_text`ã€`app_type`ã€`interaction_spec`ã€`generated_file_paths`
- æ‰“å°ç»“æ„åŒ–æ—¥å¿—ï¼šfailsã€warningsã€hints
- å°† L0 å¤±è´¥æ˜ å°„åˆ°é—¨ç¦ç»“æœï¼Œè§¦å‘è‡ªæ„ˆæµç¨‹

### 4. è‡ªæ„ˆå¢å¼º

#### `backend/self_heal.py`
- æ£€æµ‹ L0 é—¨ç¦å¤±è´¥ï¼ˆç‰¹åˆ«æ˜¯ shadcn Input å’Œ CSS Modules é—®é¢˜ï¼‰
- æ·»åŠ ä¸“é—¨çš„ä¿®å¤æŒ‡å¯¼ï¼š
  - **Sudoku ä¸“ç”¨ç­–ç•¥**ï¼šç¦ç”¨ shadcn Inputã€å°† className æ–½åŠ åœ¨åŸç”Ÿå…ƒç´ ã€ç¦æ­¢ `:global`/`!important` ç»•è¿‡
  - **CSS Modules è§„åˆ™**ï¼šåŒååŒç›®å½•ã€å¿…é¡» importã€ç¦æ­¢ `:global`ã€ç¦æ­¢ `@import`

### 5. å›å½’æµ‹è¯•

#### `backend/test_l0_gates.py`
- è¦†ç›– Gate1-Gate6 çš„æ‰€æœ‰åœºæ™¯
- ç»“æ„æ€§åº”ç”¨ vs æ™®é€šåº”ç”¨çš„åŒºåˆ†é€»è¾‘
- **Sudoku ç»å…¸çº¸è´¨é£æ ¼å›å½’æµ‹è¯•**ï¼šéªŒè¯æ­£ç¡®å®ç°ä¸è§¦å‘ä»»ä½• gate

## âœ… æµ‹è¯•ç»“æœ

```
============================================================
L0 äº¤äº’/æ ·å¼é—¨ç¦å›å½’æµ‹è¯•
============================================================

=== Gate1 æµ‹è¯•ï¼šç»“æ„æ€§åº”ç”¨ç¦æ­¢ shadcn Input ===
âœ“ Gate1 æ­£ç¡®æ£€æµ‹åˆ° shadcn Input è¿è§„
âœ“ Gate1 æ­£ç¡®é€šè¿‡åŸç”Ÿ input

=== Gate2 æµ‹è¯•ï¼šCSS Modules åŒååŒç›®å½• + import ===
âœ“ Gate2 æ­£ç¡®æ£€æµ‹åˆ°å­¤å„¿ CSS Module
âœ“ Gate2 æ­£ç¡®æ£€æµ‹åˆ° CSS Module æœªå¯¼å…¥
âœ“ Gate2 æ­£ç¡®é€šè¿‡

=== Gate3 æµ‹è¯•ï¼šç¦æ­¢å±é™© CSS ===
âœ“ Gate3 æ­£ç¡®æ£€æµ‹åˆ° :global
âœ“ Gate3 æ­£ç¡®æ£€æµ‹åˆ° @import

=== Gate4 æµ‹è¯•ï¼šå—æ§è¾“å…¥é—­ç¯ ===
âœ“ Gate4 æ­£ç¡®æ£€æµ‹åˆ°ç¼ºå°‘ onChange
âœ“ Gate4 æ­£ç¡®é€šè¿‡

=== Gate5 æµ‹è¯•ï¼šreadOnly é€»è¾‘ ===
âœ“ Gate5 æ­£ç¡®æ£€æµ‹åˆ°ç»“æ„æ€§åº”ç”¨çš„é”™è¯¯ readOnly
âœ“ Gate5 æ­£ç¡®åŒºåˆ†ç»“æ„æ€§åº”ç”¨å’Œæ™®é€šåº”ç”¨

=== Gate6 æµ‹è¯•ï¼šå­¤å„¿æ–‡ä»¶æ£€æµ‹ ===
âœ“ Gate6 æ­£ç¡®æ£€æµ‹åˆ°ç»“æ„æ€§åº”ç”¨çš„å­¤å„¿æ–‡ä»¶ï¼ˆErrorï¼‰
âœ“ Gate6 æ­£ç¡®åŒºåˆ†ç»“æ„æ€§åº”ç”¨å’Œæ™®é€šåº”ç”¨çš„å­¤å„¿æ–‡ä»¶
âœ“ Gate6 æ­£ç¡®é€šè¿‡

=== Sudoku ç»å…¸çº¸è´¨é£æ ¼å›å½’æµ‹è¯• ===
âœ“ Sudoku ç»å…¸çº¸è´¨é£æ ¼å›å½’æµ‹è¯•é€šè¿‡ï¼
   - Gate1: âœ“ æ²¡æœ‰ä½¿ç”¨ shadcn Input
   - Gate2: âœ“ CSS Modules æ­£ç¡®å…±å­˜
   - Gate3: âœ“ æ²¡æœ‰å±é™© CSS
   - Gate4: âœ“ å—æ§è¾“å…¥é—­ç¯æ­£ç¡®
   - Gate5: âœ“ readOnly åŸºäº isOriginal
   - Gate6: âœ“ æ‰€æœ‰ç»„ä»¶è¢«æ­£ç¡®å¼•ç”¨

============================================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼L0 é—¨ç¦å·¥ä½œæ­£å¸¸
============================================================
```

## ğŸš€ ä½¿ç”¨æ•ˆæœ

### é—®é¢˜è§£å†³

**åŸé—®é¢˜**ï¼šç”¨æˆ·æç¤º AI å°† Sudoku UI æ”¹ä¸º"ç»å…¸çº¸è´¨æ•°ç‹¬"é£æ ¼ï¼Œä½†æ ·å¼ä¸ç”Ÿæ•ˆã€‚

**æ ¹æœ¬åŸå› **ï¼š
1. AI ä½¿ç”¨äº† `@/components/ui/input`ï¼ˆshadcn/ui Input ç»„ä»¶ï¼‰
2. shadcn/ui Input çš„é»˜è®¤æ ·å¼è¦†ç›–äº† CSS Modules å®šä¹‰çš„ç²¾ç»†æ ·å¼ï¼ˆ48px Ã— 48pxã€è¾¹æ¡†ç²—ç»†ï¼‰
3. CSS Modules çš„ `className` åªæ–½åŠ åœ¨ wrapper div ä¸Šï¼Œè€Œä¸æ˜¯å¯è§çš„ input å…ƒç´ æœ¬ä½“

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **Gate1** æ£€æµ‹åˆ°ç»“æ„æ€§åº”ç”¨ä½¿ç”¨äº† shadcn Inputï¼Œæ ‡è®°ä¸º Fail
- è§¦å‘è‡ªæ„ˆæµç¨‹ï¼ŒAI æ”¶åˆ°ä¸“é—¨çš„ä¿®å¤æŒ‡å¯¼ï¼š
  ```
  ğŸš¨ STRUCTURAL APP DETECTED - SHADCN INPUT FORBIDDEN:
  1. DO NOT use @/components/ui/input
  2. Replace <Input> with native <input> or <button>
  3. Apply CSS Modules className DIRECTLY on the visible element
  
  âŒ WRONG:
  <div className={styles.cell}>
    <Input value={value} />
  </div>
  
  âœ… CORRECT:
  <input className={styles.cell} value={value} ... />
  ```
- AI è‡ªåŠ¨ä¿®å¤ï¼šç§»é™¤ shadcn Inputï¼Œä½¿ç”¨åŸç”Ÿ `<input>`ï¼Œå°†æ ·å¼æ–½åŠ åœ¨ input æœ¬ä½“
- æ ·å¼æ­£ç¡®ç”Ÿæ•ˆï¼š48px æ ¼å­ã€3px ç²—è¾¹æ¡†åˆ†éš” 3Ã—3 å®«æ ¼ã€1px ç»†è¾¹æ¡†åˆ†éš”å•å…ƒæ ¼

### æ—¥å¿—ç¤ºä¾‹

ç”Ÿæˆ Sudoku æ—¶çš„åç«¯æ—¥å¿—ï¼š
```
   ğŸš¦ è¿è¡Œè´¨é‡é—¨ç¦: L0_style_interaction, L0_static, L1_typecheck, L2_smoke_test

   ğŸš¨ L0 äº¤äº’/æ ·å¼é—¨ç¦å¤±è´¥:
     âœ— G1_STRUCTURAL_NO_SHADCN_INPUT: ç»“æ„æ€§åº”ç”¨ï¼ˆç½‘æ ¼/æ£‹ç›˜/ç”»å¸ƒï¼‰ä¸å¾—ä½¿ç”¨ shadcn Input ç»„ä»¶
       æ¶‰åŠæ–‡ä»¶: src/components/generated/sudoku/SudokuCell.tsx
       å»ºè®®: å°† <Input> æ›¿æ¢ä¸ºåŸç”Ÿ <input> æˆ– <button>ï¼Œå¹¶å°† CSS Modules çš„ className æ–½åŠ åœ¨åŸç”Ÿå…ƒç´ æœ¬ä½“ä¸Š

   ğŸ’¡ æ£€æµ‹åˆ°ç»“æ„æ€§åº”ç”¨ï¼ˆç½‘æ ¼/æ£‹ç›˜/ç”»å¸ƒç±»ï¼‰ï¼Œå°†åº”ç”¨æ›´ä¸¥æ ¼çš„äº¤äº’/æ ·å¼è§„åˆ™
   ğŸ’¡ å¯¹äºç½‘æ ¼/æ£‹ç›˜ UIï¼šä½¿ç”¨åŸç”Ÿ input/button å¹¶å°† CSS Modules ç±»æ–½åŠ åœ¨å¯è§å…ƒç´ æœ¬ä½“

   ğŸ”§ è§¦å‘è‡ªæ„ˆå¾ªç¯...
   
   âš ï¸âš ï¸âš ï¸ CRITICAL - L0 STYLE/INTERACTION GATE FAILURES âš ï¸âš ï¸âš ï¸
   
   ğŸš¨ STRUCTURAL APP DETECTED - SHADCN INPUT FORBIDDEN:
   For Sudoku specifically:
   - Use native <input> for editable cells
   - Apply grid border styles via CSS Modules (3px for 3Ã—3 blocks, 1px for cells)
   
   âœ“ è‡ªæ„ˆæˆåŠŸï¼
```

## ğŸ“Š å½±å“èŒƒå›´

### å—ç›Šåº”ç”¨ç±»å‹
- **æ•°ç‹¬ï¼ˆSudokuï¼‰**ï¼š9Ã—9 ç½‘æ ¼ + 3Ã—3 å®«æ ¼ç²—è¾¹æ¡†
- **æ‰«é›·ï¼ˆMinesweeperï¼‰**ï¼šæ ¼å­ç½‘æ ¼ + ç²¾ç¡®å°ºå¯¸
- **2048**ï¼š4Ã—4 ç½‘æ ¼ + åŠ¨ç”»
- **è±¡æ£‹/å›´æ£‹/äº”å­æ£‹**ï¼šæ£‹ç›˜ç½‘æ ¼
- **æ—¥å†/ç”˜ç‰¹å›¾/çœ‹æ¿**ï¼šå¤æ‚å¸ƒå±€ç½‘æ ¼
- **åƒç´ ç”»å¸ƒ/æ‹–æ‹½ç¼–è¾‘å™¨**ï¼šç²¾ç»†æ§åˆ¶å…ƒç´ 

### ä¸å—å½±å“çš„åº”ç”¨
- **è¡¨å•/è®¾ç½®é¡µ/æœç´¢**ï¼šå¯ä»¥ç»§ç»­ä½¿ç”¨ shadcn/ui Inputï¼ˆL0 é—¨ç¦ä¸è§¦å‘ï¼‰
- **æ™®é€š CRUD**ï¼šä¸æ¶‰åŠç»“æ„æ€§ UI
- **Landing Page/Dashboard**ï¼šä¸»è¦ç”¨ Cardã€Button ç­‰éç½‘æ ¼ç»„ä»¶

## ğŸ”§ é…ç½®ä¸æ‰©å±•

### æ·»åŠ æ–°çš„ç»“æ„æ€§å…³é”®è¯
ç¼–è¾‘ `backend/policies/generation_policy.json`ï¼š
```json
{
  "l0_style_gates": {
    "structural_keywords": [
      "sudoku", "grid", "board",
      "your-new-keyword"  // æ·»åŠ è¿™é‡Œ
    ],
    "structural_filename_keywords": [
      "Sudoku", "Grid",
      "YourNewComponent"  // æ·»åŠ è¿™é‡Œ
    ]
  }
}
```

### è°ƒæ•´ä¸¥é‡çº§åˆ«
```json
{
  "l0_style_gates": {
    "gate5_structural_fail": false,  // Gate5 æ”¹ä¸º Warning
    "gate6_orphan_severity_mode": "warn_default"  // æ‰€æœ‰å­¤å„¿æ–‡ä»¶éƒ½æ˜¯ Warning
  }
}
```

### ç¦ç”¨ç‰¹å®š Gate
ä¿®æ”¹ `backend/l0_gates.py` çš„ `check()` æ–¹æ³•ï¼Œæ³¨é‡Šæ‰ä¸éœ€è¦çš„ gateã€‚

## ğŸ“ æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **AST æ›¿ä»£ Regex**ï¼šä½¿ç”¨ `esprima` æˆ– `@babel/parser` è§£æ TypeScript ASTï¼Œæå‡æ£€æµ‹å‡†ç¡®æ€§
2. **ç™½åå•è±å…**ï¼šå…è®¸åœ¨è¡¨å•ç±»é¡µé¢ä½¿ç”¨ shadcn Inputï¼ˆé€šè¿‡ app_type æˆ– prompt åˆ¤æ–­ï¼‰
3. **æ›´å¤šå±é™© CSS æ¨¡å¼**ï¼š`@keyframes`ï¼ˆå¦‚æœæ±¡æŸ“å…¨å±€ï¼‰ã€`position: fixed`ï¼ˆå¯èƒ½è„±ç¦»å¸ƒå±€ï¼‰
4. **ç»„ä»¶å¤ç”¨åº¦åˆ†æ**ï¼šæ£€æµ‹æ˜¯å¦æœ‰é‡å¤é€»è¾‘åº”è¯¥æ‹†åˆ†ä¸ºå…¬å…±ç»„ä»¶
5. **æ€§èƒ½é—¨ç¦ï¼ˆL0.5ï¼‰**ï¼šæ£€æµ‹å¤§å‹å†…è” base64ã€æœªä¼˜åŒ–çš„å›¾ç‰‡ã€è¿‡å¤šçš„ useEffect

## ğŸ¯ æ€»ç»“

**L0 äº¤äº’/æ ·å¼é—¨ç¦**æˆåŠŸå®ç°äº†ï¼š
- âœ… **æœ€å¿«å¤±è´¥ä¼˜å…ˆ**ï¼šåœ¨ AI ç”Ÿæˆåç«‹å³æ£€æŸ¥ï¼Œé¿å…åç»­ç¼–è¯‘/è¿è¡Œæ—¶æ‰å‘ç°é—®é¢˜
- âœ… **ç»“æ„æ€§åº”ç”¨ä¸“ç”¨è§„åˆ™**ï¼šé’ˆå¯¹ç½‘æ ¼/æ£‹ç›˜ç±» UI çš„ç‰¹æ®Šéœ€æ±‚ï¼ˆç²¾ç¡®æ ·å¼ã€åŸç”Ÿå…ƒç´ ï¼‰
- âœ… **è‡ªæ„ˆé©±åŠ¨**ï¼šå¤±è´¥æ—¶æä¾›å¯æ‰§è¡Œçš„ä¿®å¤å»ºè®®ï¼ŒAI è‡ªåŠ¨ä¿®å¤
- âœ… **é›¶è¯¯ä¼¤**ï¼šæ™®é€šåº”ç”¨ä¸å—å½±å“ï¼Œç»§ç»­ä½¿ç”¨ shadcn/ui ç»„ä»¶åº“
- âœ… **å¯é…ç½®å¯æ‰©å±•**ï¼šå…³é”®è¯ã€ä¸¥é‡çº§åˆ«ã€é—¨ç¦å¼€å…³éƒ½å¯é…ç½®

**ç›´æ¥è§£å†³äº†ç”¨æˆ·çš„ç—›ç‚¹**ï¼š
> "è¯·æŠŠå½“å‰ Sudoku æ¸¸æˆçš„ UI æ ·å¼æ”¹ä¸º"ç»å…¸çº¸è´¨æ•°ç‹¬"é£æ ¼ï¼Œä½†æ˜¯æ ·å¼éƒ½æ²¡æœ‰ç”Ÿæ•ˆã€‚"

ç°åœ¨ï¼Œè¿™ä¸ªé—®é¢˜å°†è¢« L0 é—¨ç¦è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚ğŸ‰

